(function(b){function g(){ListView.call(this);this.name="ItemView";this.currentEvent=null;this.allDataLoaded=false}Temp.prototype=ListView.prototype;g.prototype=new Temp;itemView=new g;g.prototype.renderMenu=function(){this_object=this;menu=new CC_Menu("Men&uuml;");menu.addEntry("Hilfe","ahelp","question-sign");menu.renderDiv("cdb_menu",churchcore_handyformat())?b("#cdb_menu a").click(function(){if(b(this).attr("id")=="anewentry")this_object.renderAddEntry();else if(b(this).attr("id")=="aexport")churchcore_openNewWindow("?q=churchservice/exportfacts");
else b(this).attr("id")=="ahelp"&&churchcore_openNewWindow("http://intern.churchtools.de/?q=help&doc=ChurchService");return false}):b("#cdb_menu").hide()};g.prototype.getCountCols=function(){return 2};g.prototype.groupingFunction=function(c){var d=c.startdate.toDateEn(false).toStringDe(),e={};b.each(allEvents,function(i,h){h.startdate.toDateEn(false).toStringDe()==d&&h.facts!=null&&b.each(h.facts,function(j,k){if(e[j]==null)e[j]=0;e[j]+=k.value*1})});var f=c.startdate.toDateEn(false).getDayInText()+
", "+c.startdate.toDateEn(false).toStringDe();b.each(churchcore_sortMasterData(masterData.fact),function(i,h){f+='<td class="grouping">';if(e[h.id]!=null)f+=e[h.id]});return f};g.prototype.addFurtherListCallbacks=function(c){var d=this;b(".hover").hover(function(){b("#headerspan"+b(this).attr("id").substr(6,99)).fadeIn("fast",function(){})},function(){b("#headerspan"+b(this).attr("id").substr(6,99)).fadeOut("fast")});b(c+" a").click(function(){if(b(this).attr("id")==null)return true;else if(b(this).attr("id").indexOf("addMoreCols")==
0)d.addMoreCols();else if(b(this).attr("id").indexOf("delCol")==0){var e=b(this).attr("id").substr(6,99);masterData.settings["viewgroup"+e]=0;churchInterface.jsonWrite({func:"saveSetting",sub:"viewgroup"+e,val:0});d.renderList()}})};g.prototype.renderFilter=function(){var c=this,d=new CC_Form("Event"),e=[];b.each(churchcore_sortData(allEvents,"startdate"),function(f,i){e.push({id:i.id,bezeichnung:i.startdate.toDateEn(true).toStringDe(true)+" - "+i.bezeichnung.trim(50)})});d.addSelect({data:e,sort:false,
cssid:"event"});b("#cdb_filter").html(d.render(true));b("#cdb_filter").find("#event").change(function(){c.currentEvent=b(this).val();c.renderList()})};g.prototype.getListHeader=function(){if(this.currentEvent==null||allEvents[this.currentEvent]==null)b("#cdb_group").html("Kein Event ausgew&auml;hlt");else{a=allEvents[this.currentEvent];var c=new CC_Form;c.addHtml("<legend>"+a.bezeichnung+" - "+a.startdate.toDateEn(true).toStringDe(true)+"</legend>");b("#cdb_group").html(c.render(true));var d=[];d.push("<th>L&auml;nge<th>Text<th>Verantwortlich");
b.each(this.sortMasterData(masterData.servicegroup),function(e,f){if(masterData.settings["viewgroup"+f.id]==null||masterData.settings["viewgroup"+f.id]==1)if(masterData.auth.viewgroup[f.id]||this_object.filter["filterMeine Filter"]==2){d.push('<th class="hover" id="header'+f.id+'">'+f.bezeichnung);d.push('<span id="headerspan'+f.id+'" style="display:none;float:right"><a href="#" id="delCol'+f.id+'">'+this_object.renderImage("minus",16)+"</a></span>")}});d.push('<th width="16px"><a href="#" id="addMoreCols">'+
this.renderImage("plus",16)+"</a>");d.push("<th>"+form_renderImage({src:"paperclip.png",width:18}));return d.join("")}};g.prototype.renderListEntry=function(){return""};g.prototype.messageReceiver=function(c){if(c=="allDataLoaded")this.allDataLoaded=true;if(this==churchInterface.getCurrentView())if(c=="allDataLoaded"){this.renderFilter();this.renderList()}};g.prototype.addSecondMenu=function(){return""}})(jQuery);
