(function(c){function m(){CDBStandardTableView.call(this);this.name="GroupView";this.sortVariable="bezeichnung";this.range_endday=this.range_startday=null}Temp.prototype=CDBStandardTableView.prototype;m.prototype=new Temp;groupView=new m;m.prototype.getData=function(b){return b?churchcore_sortData(masterData.groups,this.sortVariable):masterData.groups};m.prototype.renderMenu=function(){this_object=this;menu=new CC_Menu("Men&uuml;");menu.addEntry("Zur&uuml;ck zur Personenliste","apersonview","arrow-left");
masterData.auth.admingroups&&menu.addEntry("Neue Gruppe anlegen","anewentry","cog");menu.addEntry("Weitere Filter","aaddfilter","filter");c("#cdb_group").html("");c("#cdb_todos").html("");this.renderDistrict();this.renderGrouptype();if(menu.renderDiv("cdb_menu")){rows=[];rows.push('<div id="divnewentry" style="display:none" class="new-entry"></div>');rows.push('<div id="divaddfilter" cstyle="display:none" lass="new-entry" style="width:100%;"></div>');c("#cdb_precontent").html(rows.join(""));c("#cdb_menu a").click(function(){if(c(this).attr("id")==
"anewentry")this_object.renderAddEntry();else if(c(this).attr("id")=="aaddfilter"){this_object.furtherFilterVisible=this_object.furtherFilterVisible?false:true;this_object.renderFurtherFilter()}else if(c(this).attr("id")=="aadmin"){menuDepth=c(this).attr("id");this_object.renderMenu()}else if(c(this).attr("id")=="apersonview"){menuDepth="amain";c("#cdb_group").html("");if(masterData.settings.churchdbInitView!="PersonView"){masterData.settings.churchdbInitView="PersonView";churchInterface.jsonWrite({func:"saveSetting",
sub:"churchdbInitView",val:"PersonView"})}churchInterface.setCurrentView(personView)}else if(c(this).attr("id")=="amain"){menuDepth="amain";c("#cdb_group").html("");this_object.renderMenu()}return false})}else c("#cdb_menu").hide()};m.prototype.messageReceiver=function(b,d){this==churchInterface.getCurrentView()&&b!="allDataLoaded"&&b=="filterChanged"&&this.msg_filterChanged(d[0],d[1])};m.prototype.renderDistrict=function(){var b=this,d=[],g=b.filter.filterDistrikt;if(g==null){if(c("#cdb_group").html()!=
""){b.range_startday=null;c("#cdb_group").html(d.join(""));b.renderGrouptype()}}else if(masterData.districts[g]!=null){d.push('<div class="well">');d.push("<legend>Distrikt: "+masterData.districts[g].bezeichnung+"</legend>");d.push('<div class="container-fluid">');d.push('<div class="span4">');var h=[];c.each(allPersons,function(j,a){a.districts!=null&&a.districts[g]&&h.push(a)});if(h.length==0)masterData.auth.admingroups&&d.push('<p><a href="#" class="add-person btn btn-small">Eine Person zuordnen</a>');
else{d.push('<table class="table table-condensed"><tr><th>Zugeordnete Personen<th>');c.each(churchcore_sortData(h,"name"),function(j,a){d.push('<tr><td><a href="#" class="visit-person" tooltip="'+a.id+'" >'+a.vorname+" "+a.name+"</a>");masterData.auth.admingroups&&d.push('<td><a href="#" class="del-person"data-id="'+a.id+'">'+this_object.renderImage("trashbox")+"</a>")});d.push("</table>");masterData.auth.admingroups&&d.push('<p><a href="#" class="add-person btn btn-small">Weitere Person zuordnen</a>')}d.push("</div>");
d.push('<div class="span8">');if(masterData.auth.viewhistory){d.push('<p>&Auml;nderungen anzeigen innerhalb von: <div id="slider"></div>');d.push('<span class="pull-right" id="slider_value"></div>')}d.push("</div>");d.push("</div>");c("#cdb_group").html(d.join(""));if(masterData.auth.viewhistory){var f=null;if(b.range_startday==null)b.range_startday=-31;if(b.range_endday==null)b.range_endday=0;c("#slider").slider({range:true,min:-365,max:0,values:[b.range_startday,b.range_endday],slide:function(j,
a){b.range_startday=a.values[0];b.range_endday=a.values[1];e(b.range_startday,b.range_endday)}});var e=function(j,a){var k=new Date;k.addDays(j);j=new Date;j.addDays(a);c("#slider_value").html(k.toStringDe()+" - "+j.toStringDe());f!=null&&window.clearTimeout(f);f=window.setTimeout(function(){b.renderList()},100)};e(b.range_startday,b.range_endday)}c("#cdb_group a").click(function(){if(c(this).hasClass("del-person")){var j=c(this).attr("data-id");churchInterface.jsendWrite({func:"delPersonDistrictRelation",
id:j,distrikt_id:g},function(a,k){if(a){delete allPersons[j].districts[g];b.renderDistrict()}else alert("Fehler beim Entfernen der Person-Gruppenbeziehung: "+k)})}else if(c(this).hasClass("add-person")){personView.renderPersonSelect("Nach einer Person suchen",true,function(a){churchInterface.jsendWrite({func:"addPersonDistrictRelation",id:a,distrikt_id:g},function(k,v){if(k){if(allPersons[a].districts==null)allPersons[a].districts={};k={};k.distrikt_id=g;k.person_id=a;allPersons[a].districts[g]=k;
b.renderDistrict()}else alert("Fehler beim Erstellen der Person-Gruppenbeziehung: "+v)})});return false}else if(c(this).hasClass("visit-person")){c("#cdb_group").html("");churchInterface.setCurrentView(personView);personView.clearFilter();personView.setFilter("searchEntry","#"+c(this).attr("tooltip"));personView.renderView()}return false})}};m.prototype.renderGrouptype=function(){var b=this,d=[],g=b.filter.filterGruppentyp;if(g==null){if(c("#cdb_group").html()!=""){c("#cdb_group").html(d.join(""));
b.renderDistrict()}}else{d.push('<div class="well">');d.push("<legend>Gruppentyp: "+masterData.groupTypes[g].bezeichnung+"</legend>");d.push('<div class="container-fluid">');d.push('<div class="span5">');var h=[];c.each(allPersons,function(f,e){e.gruppentypen!=null&&e.gruppentypen[g]&&h.push(e)});if(h.length==0)masterData.auth.admingroups&&d.push('<p><a href="#" class="add-person btn btn-small">Eine Person zuordnen</a>');else{d.push('<table class="table table-condensed"><tr><th>Zugeordnete Personen<th>');
c.each(churchcore_sortData(h,"name"),function(f,e){d.push('<tr><td><a href="#" class="visit-person" tooltip="'+e.id+'" >'+e.vorname+" "+e.name+"</a>");masterData.auth.admingroups&&d.push('<td><a href="#" class="del-person"data-id="'+e.id+'">'+this_object.renderImage("trashbox")+"</a>")});d.push("</table>");masterData.auth.admingroups&&d.push('<p><a href="#" class="add-person btn btn-small">Weitere Person zuordnen</a>')}d.push("</div>");d.push('<div class="span5">');d.push("</div>");d.push("</div>");
c("#cdb_group").html(d.join(""));c("#cdb_group a").click(function(){if(c(this).hasClass("del-person")){var f=c(this).attr("data-id");churchInterface.jsendWrite({func:"delPersonGruppentypRelation",id:f,gruppentyp_id:g},function(e,j){if(e){delete allPersons[f].gruppentypen[g];b.renderGrouptype()}else alert("Fehler beim Entfernen der Person-Gruppentypbeziehung: "+j)})}else if(c(this).hasClass("add-person")){personView.renderPersonSelect("Nach einer Person suchen",true,function(e){churchInterface.jsendWrite({func:"addPersonGruppentypRelation",
id:e,gruppentyp_id:g},function(j,a){if(j){if(allPersons[e].gruppentypen==null)allPersons[e].gruppentypen={};j={};j.gruppentyp_id=g;j.person_id=e;allPersons[e].gruppentypen[g]=j;b.renderGrouptype()}else alert("Fehler beim Erstellen der Person-Gruppentypbeziehung: "+a)})});return false}else if(c(this).hasClass("visit-person")){c("#cdb_group").html("");churchInterface.setCurrentView(personView);personView.clearFilter();personView.setFilter("searchEntry","#"+c(this).attr("tooltip"));personView.renderView()}return false})}};
m.prototype.msg_filterChanged=function(b){if(b=="filterDistrikt"){this.renderDistrict();if(masterData.settings.filterDistrikt!=this.filter.filterDistrikt){masterData.settings.filterDistrikt=this.filter.filterDistrikt;churchInterface.jsonWrite({func:"saveSetting",sub:"filterDistrikt",val:masterData.settings.filterDistrikt==null?"null":masterData.settings.filterDistrikt})}}else b=="filterGruppentyp"&&this.renderGrouptype()};m.prototype.renderListMenu=function(){searchEntry=this.getFilter("searchEntry");
var b=new CC_Navi;b.addEntry(true,"id1","Gruppenliste");b.addSearch(searchEntry);b.renderDiv("cdb_search")};m.prototype.renderAddEntry=function(){var b="";b+='<div class="well"><div class="row-fluid">';var d=new CC_Form("Name");d.surroundWithDiv("span4");d.addInput({label:"Name der Gruppe",cssid:"inputName"});b+=d.render();d=new CC_Form("Gruppe");d.surroundWithDiv("span4");d.addSelect({label:"Gruppentyp",cssid:"Inputf_grouptype",data:masterData.groupTypes});b+=d.render();d=new CC_Form("Distrikt");
d.surroundWithDiv("span4");d.addSelect({label:"Distrikt",cssid:"Inputf_district",data:masterData.districts});b+=d.render();b+='</div><div class="row-fluid">';d=new CC_Form;d.surroundWithDiv("span12");d.addButton({label:"Gruppe anlegen",controlgroup:true,cssid:"btProoveNewAddress"});d.addHtml("&nbsp; ");d.addCheckbox({cssid:"forceCreate",controlgroup_start:true,label:"auch anlegen, wenn es den Namen schon gibt"});d.addCheckbox({cssid:"forceDontHide",controlgroup_end:true,label:"weitere Gruppe anlegen"});
b+=d.render(false,"vertical");b+="</div>";c("#divnewentry").html(b);c("#btProoveNewAddress").click(function(){var g={};g.func="createGroup";g.name=c("#inputName").val();c("#divnewentry select").each(function(){g[c(this).attr("id")]=c(this).val()});if(c("#forceCreate").attr("checked")=="checked")g.force="checked";c.getJSON("index.php?q=churchdb/ajax",g,function(h){if(h.result=="exist"){c("#searchEntry").val(h.id).keyup();alert("Mindestens eine Gruppe mit dem Namen existiert schon!")}else{c("#searchEntry").val(h.id).keyup();
cdb_loadMasterData(function(){t.filter={};t.filter.searchEntry=h.id;if(c("#forceDontHide").attr("checked")=="checked"){t.renderList();t.renderListMenu()}else t.renderView()})}})});c("#divnewentry").animate({height:"toggle"},"slow")};m.prototype.renderFilter=function(){var b=new CC_Form;b.setLabel("Filterfunktionen");var d=personView.getMyGroupsSelector();d!=false&&b.addSelect({label:"Meine Gruppen",selected:groupView.filter["filterMeine Gruppen"],cssid:"filterMeine Gruppen",data:d,type:"medium",sort:false});
b.addSelect({freeoption:true,label:"Distrikt",selected:personView.filter.filterDistrikt,cssid:"filterDistrikt",data:churchcore_sortData(masterData.districts,"bezeichnung"),func:function(g){if(masterData.auth.admingroups)return true;if(allPersons[masterData.user_pid]!=null&&allPersons[masterData.user_pid].districts!=null&&allPersons[masterData.user_pid].districts[g.id]!=null)return true;var h=false;c.each(d,function(f,e){if(masterData.groups[e.id]!=null&&masterData.groups[e.id].distrikt_id==g.id)h=
true});return h},type:"medium"});b.addSelect({freeoption:true,label:"Gruppentyp",selected:personView.filter.filterGruppentyp,cssid:"filterGruppentyp",data:churchcore_sortData(masterData.groupTypes,"bezeichnung"),type:"medium",func:function(g){if(masterData.auth.viewalldetails)return true;return g.anzeigen_in_meinegruppen_teilnehmer_yn==1}});b.addCheckbox({cssid:"searchChecked",label:"markierte"});this.implantStandardFilterCallbacks(this,"cdb_search");c("#cdb_filter").html(b.render(true));c.each(this.filter,
function(g,h){c("#"+g).val(h)});this.implantStandardFilterCallbacks(this,"cdb_filter")};m.prototype.checkFilter=function(b){if(!this.isAllowedToSee(b.id))return false;searchEntry=this.getFilter("searchEntry").toUpperCase();if(searchEntry.indexOf("TAG:")==0){if(!this_object.checkFilterTag(searchEntry,b.tags))return false}else if(searchEntry!=""&&(b.bezeichnung.toUpperCase().indexOf(searchEntry)<0||searchEntry>0)&&b.id!=searchEntry)return false;if(this.filter.searchChecked!=null&&b.checked!=true)return false;
if(this.filter["filterMeine Gruppen"]!=null&&b.id!=this.filter["filterMeine Gruppen"])return false;if(this.filter.filterDistrikt!=null&&(b.distrikt_id==null||b.distrikt_id!=this.filter.filterDistrikt))return false;if(this.filter.filterGruppentyp!=null&&(b.gruppentyp_id==null||b.gruppentyp_id!=this.filter.filterGruppentyp))return false;return true};m.prototype.isAllowedToSee=function(b){if(masterData.groups!=null&&masterData.groups[b]!=null){if(masterData.auth.viewgroups!=null&&masterData.auth.viewgroups[b]!=
null&&masterData.groups[b].versteckt_yn==0)return true;if(masterData.auth.viewalldetails||masterData.auth.admingroups||groupView.isPersonLeaderOfGroup(masterData.user_pid,b)||groupView.isPersonInGroup(masterData.user_pid,b)&&groupView.isGroupViewableForMembers(b))if(masterData.groups[b].versteckt_yn==0||masterData.auth.admingroups||groupView.isPersonLeaderOfGroup(masterData.user_pid,b))return true;if(allPersons[masterData.user_pid]!=null){if(allPersons[masterData.user_pid].districts&&allPersons[masterData.user_pid].districts[masterData.groups[b].distrikt_id]!=
null)return true;if(allPersons[masterData.user_pid].gruppentypen&&allPersons[masterData.user_pid].gruppentypen[masterData.groups[b].gruppentyp_id]!=null)return true}}return false};m.prototype.initView=function(){if(this.filter==null||churchcore_isObjectEmpty(this.filter))if(masterData.settings.filterDistrikt!=null)this.filter.filterDistrikt=masterData.settings.filterDistrikt};m.prototype.getListHeader=function(){str='<th><a href="#" id="sortid">Nr.</a><th><a href="#" id="sortbezeichnung">Gruppe</a>';
str+='<th><a href="#" id="sortdistrikt_id">Distrikt</a><th><a href="#" id="sortgruppentyp_id">Gruppentyp</a>';this.filter.filterDistrikt=="null"&&delete this.filter.filterDistrikt;if(this.filter.filterGruppentyp!=null||this.filter.filterDistrikt!=null){str+="<th>Teilnehmer";if(this.range_startday!=null)str+="<th>Hinzugef&uuml;gt<th>Herausgenommen"}str+="<th>Tags";return str};m.prototype.renderListEntry=function(b){var d=this,g=[],h=false,f=0,e=0;if(this.filter.filterGruppentyp!=null||this.filter.filterDistrikt!=
null){counter=0;c.each(allPersons,function(v,o){if(o.gruppe!=null)if(d.filter.filterStatus!=null&&o.status_id!=d.filter.filterStatus||d.filter.filterStation!=null&&o.status_id!=d.filter.filterStation||d.filter.filterBereich!=null&&o.status_id!=d.filter.filterBereich)h=true;else c.each(o.gruppe,function(s,q){if(q.id==b.id)if(q.leiter==0)counter++;else if(q.leiter==-1)f+=1;else if(q.leiter==-2)e+=1})})}else counter="";if(!h||counter>0){g.push('<td><a href="#" id="detail'+b.id+'">'+b.bezeichnung+"</a>&nbsp; ");
masterData.auth.adminpersons&&b.auth!=null&&g.push(this.renderImage("schluessel",16,"Berechtigungen: "+this.getAuthAsArray(b.auth).join(", ")));if(f>0&&(masterData.auth.admingroups||d.isPersonLeaderOfGroup(masterData.user_pid,b.id)))g.push('<span title="Person soll geloescht werden" class="badge badge-important">'+f+"</span>&nbsp;");if(e>0&&(masterData.auth.admingroups||d.isPersonLeaderOfGroup(masterData.user_pid,b.id)))g.push('<span title="Person hat bzw. wurde auf Antrag auf Teilnahme gestellt" class="badge badge-info">'+
e+"</span>&nbsp;");b.distrikt_id!=null?g.push('<td><a href="#" id="filterDistrikt'+b.distrikt_id+'">'+(masterData.districts[b.distrikt_id]!=null?masterData.districts[b.distrikt_id].bezeichnung:'<font color="red">Distrikt-Id:'+b.distrikt_id+"</font>")+"</a>"):g.push("<td>-");b.gruppentyp_id!=null?g.push('<td><a href="#" id="filterGruppentyp'+b.gruppentyp_id+'">'+masterData.groupTypes[b.gruppentyp_id].bezeichnung+"</a>"):g.push("<td>-");if(this.filter.filterGruppentyp!=null||this.filter.filterDistrikt!=
null){g.push("<td>"+counter);b.max_teilnehmer!=null&&g.push(" <small>(max. "+b.max_teilnehmer+")</small>");if(d.range_startday!=null){count=0;var j=new Date;j.addDays(d.range_startday);var a=new Date;a.addDays(d.range_endday);c.each(allPersons,function(v,o){o.gruppe!=null&&c.each(o.gruppe,function(s,q){if(q.id==b.id&&q.leiter==0&&q.d!=null){s=q.d.toDateEn();if(s>=j&&s<=a)count+=1}})});g.push("<td>"+count)}if(d.range_startday!=null){count=0;j=new Date;j.addDays(d.range_startday);a=new Date;a.addDays(d.range_endday);
c.each(allPersons,function(v,o){o.oldGroups!=null&&c.each(o.oldGroups,function(s,q){if(q.gp_id==b.id&&q.leiter==-99&&q.d!=null){s=q.d.toDateEn();if(s>=j&&s<=a){count+=1;return false}}})});g.push("<td>"+count)}}var k="";b.tags!=null&&c.each(b.tags,function(v,o){if(k!="")k+=", ";if(masterData.tags[o]!=null)k+=masterData.tags[o].bezeichnung;else k=k+"null["+o+"]"});g.push("<td>"+k);return g.join("")}else return null};m.prototype.addFurtherListCallbacks=function(){c("#cdb_content a").click(function(){if(c(this).attr("id")==
null)return false;else if(c(this).attr("id").indexOf("filterDistrikt")==0){groupView.clearFilter();groupView.setFilter("filterDistrikt",c(this).attr("id").substr(14,99));groupView.renderView();return false}else if(c(this).attr("id").indexOf("filterGruppentyp")==0){groupView.clearFilter();groupView.setFilter("filterGruppentyp",c(this).attr("id").substr(16,99));groupView.renderView();return false}})};m.prototype.isPersonInGroup=function(b,d){var g=false;b!=null&&allPersons[b]!=null&&allPersons[b].gruppe!=
null&&c.each(allPersons[b].gruppe,function(h,f){if(f.id==d&&f.leiter!=99)g=true});return g};m.prototype.isGroupViewableForMembers=function(b){if(masterData.groups[b]==null||masterData.groups[b].versteckt_yn==1)return false;return masterData.groupTypes[masterData.groups[b].gruppentyp_id].anzeigen_in_meinegruppen_teilnehmer_yn==1};m.prototype.isGroupOfGroupType=function(b,d){if(masterData.groups[b]==null)return false;return masterData.groups[b].gruppentyp_id==d};m.prototype.isPersonLeaderOfGroup=function(b,
d){var g=false;if(b!=null&&allPersons[b]!=null){allPersons[b].gruppe!=null&&c.each(allPersons[b].gruppe,function(h,f){if(f.id==d&&f.leiter>0&&f.leiter!=4){g=true;return false}});if(g)return true;return this.isPersonSuperLeaderOfGroup(b,d)}return g};m.prototype.isPersonSuperLeaderOfGroup=function(b,d){if(allPersons[b]==null||masterData.groups[d]==null)return false;if(allPersons[b].districts!=null&&allPersons[b].districts[masterData.groups[d].distrikt_id]!=null)return true;if(allPersons[b].gruppentypen!=
null&&allPersons[b].gruppentypen[masterData.groups[d].gruppentyp_id]!=null)return true};m.prototype.getMemberOfGroup=function(b,d){var g={};c.each(allPersons,function(h,f){f.gruppe!=null&&c.each(f.gruppe,function(e,j){if(j.id==b&&(d==null||j.leiter==d)){e={};e.id=f.id;e.bezeichnung=f.vorname+" "+f.name;g[j.id]=e}})});return g};m.prototype.getLeaderOfGroup=function(b){var d={};c.each(allPersons,function(g,h){h.gruppe!=null&&c.each(h.gruppe,function(f,e){if(e.id==b&&e.leiter>0&&e.leiter!=4){f={};f.id=
h.id;f.bezeichnung=h.vorname+" "+h.name;d[h.id]=f}})});return d};m.prototype.editAutomaticEMails=function(b){function d(){churchInterface.jsendWrite({func:"getGroupAutomaticEMail",id:b,status_no:c("#groupMemberType").val()},function(f,e){if(f)if(e==null){c("#aktiv_yn").removeAttr("checked");c("#sender_pid").val("");c("#email_betreff").val("Infomail zur Gruppe "+masterData.groups[b].bezeichnung);masterData.settings.signature!=null&&CKEDITOR.instances.editor.setData(masterData.settings.signature)}else{e.aktiv_yn==
1?c("#aktiv_yn").attr("checked","checked"):c("#aktiv_yn").removeAttr("checked");c("#sender_pid").val(e.sender_pid);c("#email_betreff").val(e.email_betreff);CKEDITOR.instances.editor.setData(e.email_inhalt)}})}var g=[];g.push("<legend>Automatische E-Mails f&uuml;r "+masterData.groups[b].bezeichnung+"</legend>");g.push("<p><small>Sobald eine automatische Mail gespeichert und aktiviert ist, werden ab dem Zeitpunkt alle neuen Teilnehmer mit dieser E-Mail begruesst. Absender ist automatisch der erste Leiter der Gruppe</small>");
g.push('<form class="form-horizontal">');g.push(form_renderSelect({label:"Teilnehmerstatus",data:masterData.groupMemberTypes,cssid:"groupMemberType"}));g.push(form_renderCheckbox({label:"Aktivieren",checked:false,cssid:"aktiv_yn"}));var h=this.getLeaderOfGroup(b);g.push(form_renderSelect({label:"Absender",data:h,cssid:"sender_pid",freeoption:true}));g.push(form_renderInput({label:"Betreff",type:"xlarge",cssid:"email_betreff"}));g.push('<div id="editor"</div>');g.push("</form>");g=this.showDialog("Automatische E-Mails verwalten",
g.join(""),566,600,{Speichern:function(){c("#aktiv_yn").attr("checked")=="checked"&&c("#sender_pid").val()==""?alert("Es muss eine Person als Absender genommen werden!"):churchInterface.jsendWrite({func:"saveGroupAutomaticEMail",id:b,status_no:c("#groupMemberType").val(),aktiv_yn:c("#aktiv_yn").attr("checked")=="checked"?1:0,sender_pid:c("#sender_pid").val(),email_betreff:c("#email_betreff").val(),email_inhalt:CKEDITOR.instances.editor.getData()},function(f){f?alert("E-Mail wurde gespeichert"+(c("#aktiv_yn").attr("checked")==
"checked"?" und ist aktiviert!":".")):alert("Fehler: "+status)})},Schliessen:function(){c(this).dialog("close")}});form_implantWysiwygEditor("editor",false);d();g.find("#groupMemberType").change(function(){d()})};m.prototype.getStatsOfGroup=function(b){var d={};d.count_all_member=0;d.count_all_people=0;d.sum_age=0;d.count_age=0;d.sum_age_all=0;d.count_age_all=0;d.entries=[];c.each(allPersons,function(g,h){h.gruppe!=null&&c.each(h.gruppe,function(f,e){if(e.id==b&&(masterData.settings.hideStatus==null||
h.status_id!=masterData.settings.hideStatus)){if(e.leiter>=0&&e.leiter!=3){d.count_all_people+=1;if(h.geburtsdatum!=null){f=new Date(h.geburtsdatum.substr(0,4),h.geburtsdatum.substr(5,2)-1,h.geburtsdatum.substr(8,2));d.sum_age_all+=f.getAgeInYears();d.count_age_all+=1}}if(e.leiter==0){d.count_all_member+=1;if(h.geburtsdatum!=null){f=new Date(h.geburtsdatum.substr(0,4),h.geburtsdatum.substr(5,2)-1,h.geburtsdatum.substr(8,2));d.sum_age+=f.getAgeInYears();d.count_age+=1}}f=[];f.id=h.id;f.vorname=h.vorname;
f.name=h.name;f.status_id=h.status_id;if(e.d!=null)f.date=e.d.toDateEn();f.leiter=e.leiter;f.comment=e.comment;d.entries.push(f)}})});return d};m.prototype.renderTodos=function(){};m.prototype.editMailchimp=function(b){var d=this;if(masterData.groups_mailchimp==null){var g=form_showCancelDialog("Integration MailChimp","Lade Daten aus MailChimp...",300,300);churchInterface.jsendRead({func:"mailchimp",sub:"load"},function(j,a){g.dialog("close");if(j){masterData.groups_mailchimp=a;d.editMailchimp(b)}else alert("Fehler aufgetreten: "+
a)})}else{var h=[];if(masterData.groups_mailchimp.lists.total==0)h.push("Keine Liste eingerichtet. Bitte erst in MailChimp eine Liste einrichten.");else{h.push("<legend>Vorhandene Newsletter f&uuml;r Gruppe "+masterData.groups[b].bezeichnung+"</legend>");var f=[];readableList=[];c.each(masterData.groups_mailchimp.lists.data,function(j,a){f.push({id:a.id,bezeichnung:a.name});readableList[a.id]={id:a.id,bezeichnung:a.name}});h.push('<table class="table table-condensed">');h.push("<tr><th>Listenname<th>Optin notwendig<th>Verabschiedung<th>Admin informieren<th>");
c.each(masterData.groups_mailchimp.zuordnung,function(j,a){if(a!=null&&a.gruppe_id==b&&readableList[a.mailchimp_list_id]!=null){readableList[a.mailchimp_list_id].chosen=true;h.push("<tr><td>"+readableList[a.mailchimp_list_id].bezeichnung);h.push("<td>"+d.renderYesNo(a.optin_yn));h.push("<td>"+d.renderYesNo(a.goodbye_yn));h.push("<td>"+d.renderYesNo(a.notifyunsubscribe_yn));h.push('<td><a href="#" class="delMailchimp" data-id="'+a.mailchimp_list_id+'">'+form_renderImage({src:"trashbox.png",width:20})+
"</a>")}});h.push("</table>");h.push("<p><legend>Neue Zuordnung hinzuf&uuml;gen</legend>");var e=new CC_Form;e.setHelp("MailChimp-Integration");e.addSelect({data:f,cssid:"mailchimp_list_id",func:function(j){return readableList[j.id]==null||!readableList[j.id].chosen}});e.addCheckbox({label:"Neue Teilnehmer der Liste m&uuml;ssen best&auml;tigen (Optin)?",controlgroup_start:true,cssid:"optin_yn"});e.addCheckbox({label:"Verabschiedungs-EMail senden beim Verlassen der Liste?",controlgroup:false,cssid:"goodbye_yn"});
e.addCheckbox({label:"Listenadmin beim Verlassen informieren?",controlgroup_end:true,cssid:"notifyunsubscribe_yn"});e.addButton({label:"Hinzuf&uuml;gen",cssid:"addMailchimp"});h.push(e.render(true,"vertical"))}g=this.showDialog("Integration MailChimp",h.join(""),600,550,{Schliessen:function(){g.dialog("close")}});g.find("#addMailchimp").click(function(){if(c("#mailchimp_list_id").val()!=null){var j=e.getAllValsAsObject();j.gruppe_id=b;masterData.groups_mailchimp.zuordnung.push(j);j.func="mailchimp";
j.sub="add";churchInterface.jsendWrite(j);g.dialog("close");d.editMailchimp(b)}return false});g.find("a.delMailchimp").click(function(){var j=c(this);c.each(masterData.groups_mailchimp.zuordnung,function(a,k){if(k!=null&&k.gruppe_id==b&&k.mailchimp_list_id==j.attr("data-id")){delete masterData.groups_mailchimp.zuordnung[a];return false}});churchInterface.jsendWrite({func:"mailchimp",sub:"del",gruppe_id:b,mailchimp_list_id:j.attr("data-id")});g.dialog("close");d.editMailchimp(b);return false})}};m.prototype.renderEntryDetail=
function(b,d){function g(l,i){info="";if((masterData.auth.viewgroupstats||this_object.filter["filterMeine Gruppen"]==i)&&groupMeetingStats!=null&&groupMeetingStats[l]!=null&&groupMeetingStats[l][i]!=null){stats_dabei+=parseInt(groupMeetingStats[l][i].dabei);stats_stattgefunden+=parseInt(groupMeetingStats[l][i].stattgefunden);info+="<br/>";info+='<div title="';info=info+groupMeetingStats[l][i].dabei+" v. "+groupMeetingStats[l][i].stattgefunden+" Treffen, letztes am ";info+=groupMeetingStats[l][i].datum==
0?"":groupMeetingStats[l][i].datum.toDateEn().toStringDe();info+='">';masterData.groups[i].meetingList!=null&&masterData.groups[i].meetingList!="get data"&&c.each(churchcore_sortData(masterData.groups[i].meetingList,"datumvon"),function(n,p){if(p.eintragerfolgt_yn=="0")info=info+'<img src="'+masterData.modulespath+'/images/box_white.png"/>';if(p.ausgefallen_yn=="1")info+="x";else{var r=false;c.each(p.entries,function(x,w){if(w.p_id==l){r=true;info=w.treffen_yn=="1"?info+'<img src="'+masterData.modulespath+
'/images/box_green.png"/>':info+'<img src="'+masterData.modulespath+'/images/box_red.png"/>'}});if(!r&&p.eintragerfolgt_yn=="1")info=info+'<img src="'+masterData.modulespath+'/images/box_grey.png"/>'}});info=info+" <small>"+Math.round(100*groupMeetingStats[l][i].dabei/groupMeetingStats[l][i].stattgefunden)+"%</small>";info+="</div>"}return info}function h(l){return this_object.filter.filterStatus!=null&&l.status_id!=this_object.filter.filterStatus||this_object.filter.filterStation!=null&&l.status_id!=
this_object.filter.filterStation||this_object.filter.filterBereich!=null&&l.status_id!=this_object.filter.filterBereich}this_object=this;if(d==null)d=b;var f=d,e=this.getData()[f],j=masterData.auth.admingroups||this_object.isPersonLeaderOfGroup(masterData.user_pid,f);if(masterData.auth.viewgroupstats||this_object.filter["filterMeine Gruppen"]==f&&groupView.isPersonLeaderOfGroup(masterData.user_pid,f))if(masterData.groups[f].meetingList==null){masterData.groups[f].meetingList="get data";c.getJSON("index.php?q=churchdb/ajax",
{func:"GroupMeeting",sub:"getList",g_id:f},function(l){if(l!=null){masterData.groups[f].meetingList=l;c("#groupinfosTD"+b).html("");this_object.renderEntryDetail(b,d)}else masterData.groups[f].meetingList=[]})}var a=[];c("tr[id="+b+"]").after('<tr id="detail'+b+'"><td colspan="10" id="groupinfosTD'+b+'">Lade Daten..</td></tr>');a[a.length]='<div id="detail" class="detail-view">';a[a.length]='<div class="left-column">';a[a.length]='<div id="map_canvasg'+f+'" class="map-canvas"></div>';a[a.length]=
"</div>";a[a.length]='<div class="right-column">';a.push(this_object.renderTags(e.tags,masterData.auth.admingroups,f));a.push('<div class="detail-view-infobox">');a[a.length]='<p><table><tr style="background:#F4F4F4;"><td><i>In der Gruppe</i><td><i>Dabei seit</i><td><td>';stats_stattgefunden=stats_dabei=0;var k=this.getStatsOfGroup(f),v=100;k.entries.sort(function(l,i){var n=[];n[-1]=-1;n[-2]=-2;n[0]=0;n[1]=5;n[2]=4;n[3]=10;n[4]=1;if(n[l.leiter]==null)return 0;if(n[i.leiter]==null)return 0;if(n[l.leiter]<
n[i.leiter])return 1;else if(n[l.leiter]>n[i.leiter])return-1;else if(l.leiter==i.leiter)return l.name>i.name;return 0});var o=this_object.isPersonLeaderOfGroup(masterData.user_pid,f),s=this.isPersonSuperLeaderOfGroup(masterData.user_pid,f);c.each(k.entries,function(l,i){if(v>0){v--;a.push("<tr><td><p><small>");info=g(i.id,f);if(i.comment!=null&&(o||masterData.auth.editgroups))info="&nbsp;"+this_object.renderImage("comment",16,"Kommentar: "+i.comment)+info;style="color:black;";if(h(i)||i.leiter==
3)style="color:gray";if(i.leiter==-1)style="color:red;text-decoration:line-through;";else if(i.leiter==-2)style="color:#3a87ad;";a[a.length]='<a href="#" style="'+style+'" id="person_'+i.id+'" '+(masterData.auth.viewalldata?'tooltip="'+i.id+'"':"")+">"+i.vorname+" "+i.name;i.leiter>0&&a.push(" ("+masterData.groupMemberTypes[i.leiter].bezeichnung+")");i.leiter==-2&&a.push("?");a.push("</a> "+info);a.push("</small><td>");i.date!=null&&a.push("<small>"+i.date.toStringDe()+"</small>");if(masterData.auth.editgroups||
o&&i.leiter!=-1||s){a.push('<td style="width:16px;padding:0 1px"><a href="#" id="editPerson_'+i.id+'" data-pid="'+i.id+'" data-gid="'+f+'">'+t.renderImage("options",16)+"</a>");a.push('<td style="width:16px;padding:0 3px 0 0"><a href="#" id="deletePerson_'+i.id+"_"+f+'" p_id="'+i.id+'">'+this_object.renderImage("trashbox",16)+"</a>")}}});if(v==0)a[a.length]="<tr><td>..";a.push("</table></div>");if(masterData.auth.viewhistory&&this_object.range_startday!=null){a.push('<div class="detail-view-infobox">');
a.push("<p><br/><table><tr><td><i>Nicht mehr in der Gruppe</i><td><i>seit</i><td>");var q=new Date;q.addDays(this_object.range_startday);var B=new Date;B.addDays(this_object.range_endday);c.each(allPersons,function(l,i){i.oldGroups!=null&&c.each(i.oldGroups,function(n,p){p.gp_id==f&&p.leiter==-99&&p.d!=null&&p.d.toDateEn()>=q&&p.d.toDateEn()<=B&&a.push("<tr><td>"+i.vorname+" "+i.name+"<td>"+p.d.toDateEn().toStringDe())})});a.push("</table></div>")}a.push("<p></p>");if(j){masterData.groups[f].meetingList!=
null&&masterData.groups[f].meetingList!="get data"&&a.push('<p><i><a href="#" class="btn" id="del_last_statistic">Letzte Teilnehmerpflege zur&uuml;cksetzen</a></i>');if(masterData.groups[f].max_teilnehmer==null||masterData.groups[f].max_teilnehmer>k.count_all_member)a.push('<p><a href="#" class="btn btn-small" id="addPerson">Weitere Person hinzuf&uuml;gen</a>')}a.push('<p><a href="#" class="btn btn-small" id="grp_to_filter">Gruppe in Filter &uuml;bernehmen</a>');a[a.length]="</div>";a[a.length]='<div class="middle-column">';
a[a.length]="<legend>"+e.bezeichnung;if(j){a[a.length]='&nbsp;&nbsp;<a href="" id="edit_'+f+'">'+this_object.renderImage("options")+"</a>";a[a.length]='&nbsp;<a href="" title="Gruppe eine EMail senden" id="sendMail">'+this_object.renderImage("email")+"</a>"}a[a.length]="</legend><div class=well><p>";if(e.distrikt_id>0)a[a.length]='Distrikt: <a href="#" id="filterDistrikt'+e.distrikt_id+'">'+(masterData.districts[e.distrikt_id]!=null?masterData.districts[e.distrikt_id].bezeichnung:'<font color="red">Distrikt-Id:'+
e.distrikt_id+"</font>")+"</a><br/>";e.followup_typ_id!=null&&e.followup_typ_id>0&&a.push("FollowUp: "+masterData.followupTypes[e.followup_typ_id].bezeichnung+"<br/>");a[a.length]="<small>Teilnehmeranzahl: "+k.count_all_member;if(k.count_age>0){a[a.length]=" &nbsp; &#216; "+Math.round(10*k.sum_age/k.count_age)/10+"J.";if(k.count_all_member>k.count_age)a[a.length]=" ("+k.count_age+"P.)"}a[a.length]="<br/>";a[a.length]="Gesamt: "+k.count_all_people+"";if(k.count_age>0){a[a.length]=" &nbsp; &#216; "+
Math.round(10*k.sum_age_all/k.count_age_all)/10+"J.";if(k.count_all_people>k.count_age_all)a[a.length]=" ("+k.count_age_all+"P.)"}a[a.length]="</small>";if(stats_stattgefunden>0)a[a.length]="<p>Teilnehmerquote: "+Math.round(100*stats_dabei/stats_stattgefunden)+"%";a[a.length]="<p>";if(e.gruendungsdatum!=null)a[a.length]="Gr&uuml;ndungsdatum: "+e.gruendungsdatum.toDateEn().toStringDe()+" ";if(e.abschlussdatum!=null)a[a.length]="Abschlussdatum: "+e.abschlussdatum.toDateEn().toStringDe();a[a.length]=
"<p>";if(e.treffzeit!="")a[a.length]="Treffzeit: "+e.treffzeit+"<br/>";a[a.length]="Ort des Treffens: "+e.treffpunkt+"<br/>";if(e.treffname!="")a[a.length]="Treffen bei: "+e.treffname;a[a.length]="<p>";a[a.length]="Zielgruppe: "+e.zielgruppe+"<br/>";a[a.length]='Gruppentyp: <a href="#" id="filterGruppentyp'+e.gruppentyp_id+'">'+masterData.groupTypes[e.gruppentyp_id].bezeichnung+"</a>";if(e.max_teilnehmer!=null)a[a.length]="<p>Max. Teilnehmer: "+e.max_teilnehmer+"";if(e.notiz!="")a[a.length]="<br/><br/>Notiz: <i>"+
e.notiz.replace(/\n/g,"<br/>")+"</i><br/>";a.push("</div><legend>Gruppenoptionen</legend><div>");if(masterData.auth.admingroups){a[a.length]="<p>Gruppe ausw&auml;hlbar: "+this_object.renderYesNo(e.valid_yn,16);a[a.length]="<br/>Gruppe versteckt: "+this_object.renderYesNo(e.versteckt_yn,16);a[a.length]="<br/>In Statistik: "+this_object.renderYesNo(e.instatistik_yn,16);a[a.length]="<br/>Teilnahmenpflege: "+this_object.renderYesNo(e.treffen_yn,16);a[a.length]="<br/>Leiter per E-Mail informieren: "+this_object.renderYesNo(e.mail_an_leiter_yn,
16);a[a.length]="<br/><br/>Gruppe ist &ouml;ffentlich: "+this_object.renderYesNo(e.oeffentlich_yn,16);a[a.length]="<br/>Gruppe ist offen: "+this_object.renderYesNo(e.offen_yn,16)+"</p>";a.push('<p><a href="#" class="btn btn-small" id="editAutomaticEmails">Automatische E-Mails verwalten</a>');masterData.mailchimp&&a.push('<p><a href="#" class="btn btn-small" id="editMailchimp">MailChimp-Listen zuordnen</a>')}a.push("</div>");if(masterData.auth.adminpersons&&masterData.auth.adminpersons){a[a.length]=
"<br/><legend>Teilnehmerberechtigungen";a[a.length]='&nbsp;&nbsp;<a href="" id="auth_'+f+'">'+this_object.renderImage("schluessel")+"</a></legend>";e.auth==null?a.push("keine"):c.each(e.auth,function(l){a.push(this_object.renderAuth(l)+"<br/>")})}a.push("</div>");a[a.length]='<div style="clear:both">';a[a.length]='<div class="detail-footer">';a[a.length]='<div display:inline;">&nbsp;';a[a.length]='<div style="float:right"><small>';if(masterData.auth.admingroups)a[a.length]='Admin-Funktion: &nbsp;<a href="#" title="Gruppe entfernen" id="deleteGroup">'+
form_renderImage({src:"trashbox.png",width:18})+"</a>&nbsp;&nbsp;";if(e.letzteaenderung!=null)a[a.length]="&nbsp;<i>Letzte &Auml;nderung: "+e.letzteaenderung.toDateEn().toStringDe()+" durch "+e.aenderunguser+" &nbsp;";a[a.length]="&nbsp;id:"+e.id+"</i></small>&nbsp;&nbsp;";a[a.length]="</small></div></div>";a[a.length]="</div>";a[a.length]="</div>";c("#groupinfosTD"+b).html(a.join(""));this.addFurtherListCallbacks();this.addTagCallbacks(f,function(l){if(masterData.groups[f].tags==null)masterData.groups[f].tags=
[];masterData.groups[f].tags.push(l);churchInterface.jsonWrite({func:"addGroupTag",id:f,tag_id:l});this_object.renderList();this_object.renderEntryDetail(f)});c("#cdb_content a").click(function(){if(c(this).attr("id").indexOf("auth_")==0){var l=c(this).attr("id").substr(5,99);this_object.editDomainAuth(l,masterData.groups[l].auth,"gruppe",function(){cdb_loadMasterData(function(){churchInterface.getCurrentView().renderView()})});return false}else if(c(this).attr("id")=="deleteGroup"){var i=false;c.each(allPersons,
function(r,x){x.gruppe!=null&&c.each(x.gruppe,function(w,y){if(y.id==b)i=true})});var n=new CC_Form;n.addHtml("<legend>Wirklich die Gruppe l&ouml;schen?</legend>");if(i){n.addHtml("<p>Achtung, zu der Gruppe sind noch Personen zugeordnet. Sollen diese aus der Gruppe genommen werden? Das kann nicht r&uuml;ckg&auml;ngig gemacht werden!");n.addCheckbox({label:"Personen aus der Gruppe herausnehmen",cssid:"deletePersonGroup"})}var p=form_showDialog("Gruppe l&ouml;schen",n.render(null,"vertical"),370,300,
{Ja:function(){var r=n.getAllValsAsObject();if(i&&r.deletePersonGroup==0)alert("Ohne das Setzen des Hakens kann die Gruppe nicht entfernt werden!");else{r.func="deleteGroup";r.id=b;churchInterface.jsonWrite(r,function(x){if(x){delete masterData.groups[b];churchInterface.getCurrentView().renderList();p.dialog("close")}else alert("Fehler aufgetreten!")})}},Abbruch:function(){c(this).dialog("close")}});return false}});c("#groupinfosTD"+b+" a").click(function(){this_object.clearTooltip(true);if(c(this).attr("id")==
"grp_to_filter"){c("#cdb_group").html("");churchInterface.setCurrentView(personView);personView.clearFilter();personView.furtherFilterVisible=true;personView.filter["filterTyp 1"]=e.gruppentyp_id;personView.filter["filterGruppe 1"]=f;personView.currentFurtherFilter="gruppe";personView.renderView();return false}else if(c(this).attr("id").indexOf("addPerson")==0){personView.renderPersonSelect("Nach einer Person suchen",true,function(z){personView.addPersonGroupRelation(z,f)?groupView.renderList():alert("Fehler beim Erstellen der Person-Gruppenbeziehung. Ist die Person schon in der Gruppe?")});
return false}else if(c(this).attr("id").indexOf("editPerson_")==0){var l=c(this).attr("data-pid"),i=personView.renderPersonGroupRelation(c(this).attr("data-pid"),c(this).attr("data-gid"));width=380;height=330;if(i==null)return false;this_object.showDialog("Ver&auml;nderung des Datensatzes",i,380,330,{Speichern:function(){personView._saveEditEntryData(l,"editPersonGroupRelation",true,c(this))},Abbruch:function(){c(this).dialog("close")}});groupView.renderList();return false}else if(c(this).attr("id").indexOf("deletePerson_")==
0){l=c(this).attr("p_id");personView.delPersonFromGroup(l,f);groupView.renderList();return false}else if(c(this).attr("id").indexOf("editAutomaticEmails")==0){groupView.editAutomaticEMails(b);return false}else if(c(this).attr("id").indexOf("editMailchimp")==0){groupView.editMailchimp(b);return false}else if(c(this).attr("id").indexOf("person_")==0){c("#cdb_group").html("");churchInterface.setCurrentView(personView);personView.clearFilter();personView.setFilter("searchEntry","#"+c(this).attr("id").substr(7,
99));personView.renderView()}else if(c(this).attr("id").indexOf("del_last_statistic")==0){confirm("Wirklich die letzte Eintragung entfernen?")&&churchInterface.jsendWrite({func:"deleteLastGroupStatistic",id:f},function(z,u){z?cdb_loadGroupMeetingStats(churchInterface.getCurrentView().filter,f,function(){masterData.groups[f].meetingList=null;groupView.renderList()}):alert("Fehler: "+u)});return false}else if(c(this).attr("id").indexOf("grp_close")==0){c("#groupinfosTD"+b).remove();return false}else if(c(this).attr("id").indexOf("edit_")==
0){this_object.renderEditEntry(f);return false}else if(c(this).attr("id").indexOf("sendMail")==0){var n="",p="",r=true,x=false,w="",y=masterData.settings.mailerSeparator==0?";":",";if(masterData.settings.mailerType!=0)y+=" ";c.each(allPersons,function(z,u){u.gruppe!=null&&c.each(u.gruppe,function(D,C){if(C.id==f&&(masterData.settings.hideStatus==null||u.status_id!=masterData.settings.hideStatus))if(u.email=="")x=true;else{if(r)r=false;else{n+=",";p+=", "}n+=u.id;p=p+u.vorname+" "+u.name;w=w+c.trim(u.email)+
y}})});if(n=="")alert("Keine Personen mit EMail-Adressen gefunden.");else{x&&alert("Hinweis: Einige Eintr\u00e4ge haben keine E-Mailadresse, diese wurden nicht ber\u00fccksichtigt!");if(masterData.settings.mailerType==0){if(masterData.settings.mailerBcc==null)masterData.settings.mailerBcc=0;i="";i=masterData.settings.mailerBcc==0?"mailto:"+w:"mailto:"+allPersons[masterData.user_pid].email+"?bcc="+w;var A=window.open(i,"Mailer");window.setTimeout(function(){A.close()},500)}else if(masterData.settings.mailerType==
1){A=window.open("","E-Mail-Adresse","width=500,height=300");A.document.write(w);A.focus()}else masterData.settings.mailerType==2&&this_object.mailPerson(n,p.trim(80),"Gruppeninfos "+masterData.groups[f].bezeichnung)}return false}else if(c(this).attr("id").indexOf("add_tag")==0){c("#add_tag_field"+f).toggle();c("#input_tag"+f).focus();return false}else if(c(this).attr("id").indexOf("del_tag")==0){masterData.groups[f].tags.splice(c.inArray(c(this).attr("id").substring(7,99),masterData.groups[f].tags),
1);churchInterface.jsonWriteSyncron({func:"delGroupTag",id:f,tag_id:c(this).attr("id").substring(7,99)});this_object.renderView();this_object.renderEntryDetail(f);return false}else if(c(this).attr("id").indexOf("search_tag")==0){if(masterData.tags[c(this).attr("id").substring(10,99)]!=null){this_object.setFilter("searchEntry","tag:"+masterData.tags[c(this).attr("id").substring(10,99)].bezeichnung);this_object.renderView()}return false}});c("#cdb_content a[tooltip]").mouseover(function(){this_object.prepareTooltip(c(this))});
c("#cdb_content a[tooltip]").mouseout(function(){this_object.clearTooltip()});cdb_showGeoGruppe(e.treffpunkt,e.id)};m.prototype.renderTooltip=function(b,d){return personView.renderTooltip(b,d)};m.prototype.renderEditEntry=function(b,d){var g=this,h=this.showDialog("Ver&auml;nderung der Gruppe","",500,600,{Speichern:function(){c(this).attr("id");obj=g.getSaveObjectFromInputFields(b,"f_group",masterData.groups[b]);if(obj.max_teilnehmer=="")obj.max_teilnehmer=null;if(masterData.groups[b].max_teilnehmer==
"")masterData.groups[b].max_teilnehmer=null;masterData.groups[b].geolat="";c("#cbn_editor").html("<p><br/><b>Daten werden gespeichert...</b><br/><br/>");churchInterface.jsonWrite(obj,function(){churchInterface.getCurrentView().renderList()});c(this).dialog("close")},Abbruch:function(){c(this).dialog("close")}});this.renderStandardFieldsAsSelect(h,"f_group",c.extend({},masterData.groups[b]),["null"]);h.find("#Inputfu_nachfolge_typ_id").change(function(){h.dialog("close");masterData.groups[b].fu_nachfolge_typ_id=
c(this).val();g.renderEditEntry(b,d)})};m.prototype.standardFieldCoder=function(b,d){if(b=="selectNachfolgeObjektId")switch(d.fu_nachfolge_typ_id){case "1":return masterData.groupTypes;case "2":return masterData.districts;case "3":return masterData.groups;default:return null}alert("Keine Coder gefunden fuer: "+b);return null};m.prototype.renderFurtherFilter=function(){c("#divaddfilter").html('<div id="addfilter" style="width:100%;"><div style="height:200px"/></div>');if(this.furtherFilterVisible){c("#divaddfilter").animate({height:"show"},
"fast");this_object=this;var b=[];b.push('<p align="center" class="addfilter-head">Gruppenfilter');b.push('&nbsp;&nbsp;&nbsp;<small><a href="#" id="reset_personfilter" style="color:lightgrey;">(Filter zur&uuml;cksetzen)</a></small>');b.push('<p class="addfilter-body">');b.push("&nbsp;&nbsp;");b.push(this.getSelectFilter(masterData.status,"Status",this_object.filter.filterStatus));b.push(this.getSelectFilter(masterData.station,"Station",this_object.filter.filterStation));b.push(this.getSelectFilter(masterData.dep,
"Bereich",this_object.filter.filterBereich));b.push("<br/>&nbsp;&nbsp;");b.push("<i>Diesen Gruppenfilter filtern die Teilnehmer pro Gruppe, bitte vorher Distrikt oder Gruppentyp w&auml;hlen!</i>");c("#addfilter").html(b.join(""));this.implantStandardFilterCallbacks(this,"addfilter");c("#addfilter a").click(function(){this_object.filter[c(this).attr("id")]=c(this).attr("checked");if(c(this).attr("id")=="reset_personfilter"){delete this_object.filter.filterStatus;delete this_object.filter.filterStation;
delete this_object.filter.filterBereich;this_object.renderFurtherFilter();listOffset=0;this_object.renderList();return false}})}else c("#divaddfilter").animate({height:"hide"},"fast")}})(jQuery);
