function cdb_mapJsonDetails(b,a){if(a==null)a={};$.each(b,function(d,c){a[d]=c});a.details=true;a.searchable=true;return a}function cdb_mapJsonSearchable(b,a){if(a!=null){$.each(b,function(d,c){a[d]=c});a.searchable=true}return a}function cdb_addJsonRels(b,a){if(a!=null){if(a.rels==null)a.rels={};obj={};obj.id=b.id;obj.vater_id=b.v_id;obj.kind_id=b.k_id;obj.beziehungstyp_id=b.typ_id;a.rels[b.id]=obj}}function cdb_mapJsonPerson2(b,a){if(a!=null)a.gruppe=b.g;return a}
function cdb_mapJsonPerson1(b,a){if(a==null)a={};a.id=b.p_id;a.name=b.name;a.vorname=b.vorname;a.spitzname=b.spitzname;a.station_id=b.stn_id;a.status_id=b.sts_id;a.access=b.access;a.tel=b.tl;a.email=b.em;a.geolat=b.lat;a.geolng=b.lng;a.archiv_yn=b.archiv_yn;a.last_send=b.last_send;a.gruppe=b.groups;a.districts=b.districts;a.gruppentypen=b.gruppentypen;return a}
function cdb_loadRelations(b){var a=false;churchInterface.setStatus("Lade Relationen...");jQuery.each(allPersons,function(d,c){c.rels=null});churchInterface.jsonRead({func:"getAllRels"},function(d){if(d.rels!=null){jQuery.each(d.rels,function(c,e){cdb_addJsonRels(e,allPersons[e.k_id]);cdb_addJsonRels(e,allPersons[e.v_id])});if(churchInterface.getCurrentView()==personView&&personView.getFilter("searchEntry")!="")a=true}churchInterface.clearStatus();b!=null&&b(a)})}
function cdb_loadSearch(b){churchInterface.setStatus("Lade Suchdaten...");churchInterface.jsonRead({func:"getSearchableData"},function(a){jQuery.each(a.searchable,function(d,c){if(allPersons[c.id]!=null)allPersons[c.id]=cdb_mapJsonSearchable(c,allPersons[c.id])});a.oldGroupRelations!=null&&jQuery.each(a.oldGroupRelations,function(d,c){if(allPersons[c.id]!=null){if(allPersons[c.id].oldGroups==null)allPersons[c.id].oldGroups=[];allPersons[c.id].oldGroups.push(c)}});a.tagRelations!=null&&jQuery.each(a.tagRelations,
function(d,c){if(allPersons[c.id]!=null){if(allPersons[c.id].tags==null)allPersons[c.id].tags=[];allPersons[c.id].tags.push(c.tag_id)}});churchInterface.clearStatus();b!=null&&b()})}
function cdb_loadMasterData(b){churchInterface.setStatus("Lade Kennzeichen...");timers.startMasterdata=new Date;jQuery.getJSON("index.php?q=churchdb/ajax",{func:"getMasterData"},function(a){timers.endMasterdata=new Date;masterData=a;a.version!=churchdb_js_version&&alert("Achtung, Versionen unterscheiden sich, bitte Cache loeschen! php:"+a.version+"/js:"+churchdb_js_version);churchInterface.clearStatus();b!=null&&b()})}
function cdb_loadPersonData(b,a,d){window.setTimeout(function(){churchInterface.setStatus("Lade Personendaten...");timers.startAllPersons=new Date;churchInterface.jsonRead({func:"getAllPersonData",limit:a,p_id:d},function(c){timers.endAllPersons=new Date;c.persons!=null&&jQuery.each(c.persons,function(e,f){allPersons[f.p_id]=cdb_mapJsonPerson1(f,allPersons[f.p_id])});churchInterface.clearStatus();b!=null&&b()})},1)}
function cdb_loadGroupMeetingStats(b,a,d){if(a==null)a=-1;if(masterData.auth.viewgroupstats||b.filterOwnGroups!=null){masterData.auth.viewgroupstats||(a=b.filterOwnGroups);churchInterface.jsonRead({func:"GroupMeeting",sub:"stats",id:a},function(c){groupMeetingStats=c;d!=null&&d(true)})}else d!=null&&d(false)};
